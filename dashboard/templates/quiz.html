<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const course = urlParams.get('course') || "Python";
            document.getElementById("quizTitle").textContent = course + " Quiz";

            // Fetch quiz questions dynamically from Django API
            fetch(`/api/quiz?course=${course}`)
                .then(response => response.json())
                .then(data => {
                    const questions = data.questions || [];
                    const quizContainer = document.getElementById("quizQuestions");

                    if (questions.length === 0) {
                        quizContainer.innerHTML = `<p>No quiz available for this course.</p>`;
                        return;
                    }

                    let quizHTML = "";
                    questions.forEach((q, index) => {
                        quizHTML += `<div class="mb-3">
                                        <p class="question">${index + 1}. ${q.question}</p>`;
                        q.options.forEach(option => {
                            quizHTML += `<div>
                                            <input type="radio" name="q${index}" value="${option}"> 
                                            <label>${option}</label>
                                        </div>`;
                        });
                        quizHTML += `</div>`;
                    });
                    quizContainer.innerHTML = quizHTML;

                    // Handle form submission
                    document.getElementById("quizForm").addEventListener("submit", function(event) {
                        event.preventDefault();

                        let score = 0;
                        let total = questions.length;
                        let unanswered = 0;

                        questions.forEach((q, index) => {
                            let selected = document.querySelector(`input[name="q${index}"]:checked`);
                            if (!selected) {
                                unanswered++;
                            } else if (selected.value === q.answer) {
                                score++;
                            }
                        });

                        if (unanswered > 0) {
                            alert(`You left ${unanswered} question(s) unanswered! Please answer all questions.`);
                            return;
                        }

                        let level, bgColor;
                        if (score <= 5) {
                            level = "Beginner ðŸš€";
                            bgColor = "#ffcccc";
                        } else if (score <= 10) {
                            level = "Intermediate ðŸŽ¯";
                            bgColor = "#ffeb99";
                        } else {
                            level = "Advanced ðŸ”¥";
                            bgColor = "#ccffcc";
                        }

                        let resultDiv = document.getElementById("result");
                        resultDiv.innerHTML = `<h4>Your Score: ${score}/${total}</h4><h3>You are at <strong>${level}</strong> level.</h3>`;
                        resultDiv.style.background = bgColor;
                        resultDiv.style.display = "block";

                        // Show popup message
                        alert(`Your Score: ${score}/${total}\nYou are at ${level} level!`);
                    });
                })
                .catch(error => console.error("Error loading quiz:", error));
        });
    </script>
</head>
<body>
    <h2 id="quizTitle"></h2>
    <form id="quizForm">
        <div id="quizQuestions"></div>
        <button type="submit">Submit Quiz</button>
    </form>
    <div id="result" style="display: none;"></div>
</body>
</html>
